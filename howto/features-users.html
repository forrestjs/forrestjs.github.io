
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>users feature Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="features-splash.html" />
    
    
    <link rel="prev" href="features.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <a target="_blank" href="https://github.com/marcopeg/react-ssr">
            
                    
                    give us a star on GitHub!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <a target="_blank" href="https://www.npmjs.com/package/@marcopeg/react-ssr">
            
                    
                    install from NPM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../api/">
            
                <a href="../api/">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../api/create-ssr-state.html">
            
                <a href="../api/create-ssr-state.html">
            
                    
                    createSSRState
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../api/create-ssr-context.html">
            
                <a href="../api/create-ssr-context.html">
            
                    
                    createSSRContext
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../api/create-ssr-render.html">
            
                <a href="../api/create-ssr-render.html">
            
                    
                    createSSRRender
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../api/create-ssr-router.html">
            
                <a href="../api/create-ssr-router.html">
            
                    
                    createSSRRouter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../api/memcached.html">
            
                <a href="../api/memcached.html">
            
                    
                    Memcached
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Step By Step Tutorial</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="setup.html">
            
                <a href="setup.html">
            
                    
                    Prerequisites & Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="app.html">
            
                <a href="app.html">
            
                    
                    Universal App
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="app-redux.html">
            
                <a href="app-redux.html">
            
                    
                    React Redux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="app-reducers.html">
            
                <a href="app-reducers.html">
            
                    
                    Reducers & Initial State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3" data-path="features.html">
            
                <a href="features.html">
            
                    
                    Think in Features
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.2.3.1" data-path="features-users.html">
            
                <a href="features-users.html">
            
                    
                    users feature
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.3.2" data-path="features-splash.html">
            
                <a href="features-splash.html">
            
                    
                    splash-screen feature
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="ssr.html">
            
                <a href="ssr.html">
            
                    
                    Server Side Rendering
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="ssr-folders.html">
            
                <a href="ssr-folders.html">
            
                    
                    Folders structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="ssr-babel.html">
            
                <a href="ssr-babel.html">
            
                    
                    Babel setup (transpiler)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.3" data-path="ssr-npm-dependencies.html">
            
                <a href="ssr-npm-dependencies.html">
            
                    
                    NPM dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.4" data-path="ssr-npm-scripts.html">
            
                <a href="ssr-npm-scripts.html">
            
                    
                    NPM scripts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.5" data-path="ssr-frontend.html">
            
                <a href="ssr-frontend.html">
            
                    
                    the frontend script
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.6" data-path="ssr-backend.html">
            
                <a href="ssr-backend.html">
            
                    
                    the backend script
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.7" data-path="ssr-kickoff.html">
            
                <a href="ssr-kickoff.html">
            
                    
                    the kickoff scripts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.8" data-path="ssr-code-splitting.html">
            
                <a href="ssr-code-splitting.html">
            
                    
                    code splitting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="docker.html">
            
                <a href="docker.html">
            
                    
                    Deploy with Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="router.html">
            
                <a href="router.html">
            
                    
                    Add React Router
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="router-setup.html">
            
                <a href="router-setup.html">
            
                    
                    basic setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.2" data-path="router-routes.html">
            
                <a href="router-routes.html">
            
                    
                    add some routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.3" data-path="router-load.html">
            
                <a href="router-load.html">
            
                    
                    load stuff
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="seo.html">
            
                <a href="seo.html">
            
                    
                    SEO Optimization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="eslint.html">
            
                <a href="eslint.html">
            
                    
                    Customize ESLint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="graphql.html">
            
                <a href="graphql.html">
            
                    
                    Add GraphQL
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.8.1" data-path="graphql-setup.html">
            
                <a href="graphql-setup.html">
            
                    
                    setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8.2" data-path="graphql-backend.html">
            
                <a href="graphql-backend.html">
            
                    
                    backend
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8.3" data-path="graphql-frontend.html">
            
                <a href="graphql-frontend.html">
            
                    
                    frontend
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="multilanguage.html">
            
                <a href="multilanguage.html">
            
                    
                    Add Multilanguage Support
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Articles</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../articles/reducers.html">
            
                <a href="../articles/reducers.html">
            
                    
                    Reducers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../articles/services.html">
            
                <a href="../articles/services.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../articles/styled-components.html">
            
                <a href="../articles/styled-components.html">
            
                    
                    SSR with Styled Components
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other Stuff</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../DEVELOPMENT.html">
            
                <a href="../DEVELOPMENT.html">
            
                    
                    Development
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >users feature</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="users-feature">Users Feature</h2>
<p>In this feature we are going to fetch and display a list of users from
a <a href="https://jsonplaceholder.typicode.com/users" target="_blank">jsonplaceholder</a> API.</p>
<p>By the end of this tutorial we should reach together a similar outcome:</p>
<p><img src="../images/create-react-app-ssr__feature-users.png" alt="users feature"></p>
<h3 id="step-1---the-reducer">Step 1 - the reducer</h3>
<p>Let&apos;s start with the boring part. The reducer.</p>
<p>We need to keep track of the loaded users, as well of some meta data like:</p>
<ul>
<li>is the loading happending?</li>
<li>did we perform our first load? Or are we reloading?</li>
</ul>
<p>Here is the reducer code that I&apos;ve come up with.
Put this into <code>/src/features/users/users.reducer.js</code>:</p>
<pre><code>export const initialState = {
    isLoading: false,
    hasLoaded: false,
    errorMsg: null,
    list: [],
}

/**
* Actions
*/

export const LOAD_START = &apos;loadStart@users&apos;
export const LOAD_END = &apos;loadEnd@users&apos;
export const LOAD_FAILED = &apos;loadFailed@users&apos;

export const loadStart = () =&gt; ({
    type: LOAD_START,
})

export const loadEnd = users =&gt; ({
    type: LOAD_END,
    payload: users,
})

export const loadFailed = errorMsg =&gt; ({
    type: LOAD_FAILED,
    payload: errorMsg,
})

/**
* Handlers
*/

export const actionHandlers = {
    [LOAD_START]: (state) =&gt; ({
        ...state,
        isLoading: true,
    }),
    [LOAD_END]: (state, { payload }) =&gt; ({
        ...state,
        isLoading: false,
        hasLoaded: true,
        list: payload,
    }),
    [LOAD_FAILED]: (state, { payload }) =&gt; ({
        ...state,
        isLoading: false,
        hasLoaded: true,
        errorMsg: payload,
    }),
}

export default (state = initialState, action) =&gt; {
    const handler = actionHandlers[action.type]
    return handler ? handler(state, action) : state
}
</code></pre><p><strong>NOTE:</strong> If you want to deepen the understanding of this code, have a read
at the <a href="../articles/reducers.html">reducer article</a></p>
<p>Now we can add the reducer to the feature&apos;s manifest in
<code>src/features/users/index.js</code>:</p>
<pre><code>import users from &apos;./users.reducer&apos;

// exports the features capabilities:
export const reducers = { users }
export const services = []
export const listeners = []
</code></pre><p>And finally we activate our feature by listing it in the features manifest
<code>src/features/index.js</code>:</p>
<pre><code>export default [
    require(&apos;./users&apos;),
]
</code></pre><p>If everything went well, you should be able to see the new reducer correcly
listed in the app&apos; state (using Redux devTools):</p>
<p><img src="../images/create-react-app-ssr__feature-users-reducer.png" alt="users reducer"></p>
<h3 id="step-2---the-service">Step 2 - the service</h3>
<p>I use to call Redux asynchronous actions &quot;services&quot;. It is shorter and <em>IMHO</em>
does a better job of representing the purpose of that code. <a href="../articles/services.html">You can find some
more details here</a>.</p>
<p>Anyway in this file we write the logic that is in charge of fetching data from
the web and populate our reducer. All the stuff goes into
<code>src/features/users/users.service.js</code>:</p>
<pre><code>import { loadStart, loadEnd, loadFailed } from &apos;./users.reducer&apos;

export const loadUsers = () =&gt; async (dispatch, getState) =&gt; {
    try {
        dispatch(loadStart())
        const { ssr } = getState()
        const req = fetch(&apos;https://jsonplaceholder.typicode.com/users&apos;)
        const res = await ssr.await(req)
        const data = await res.json()
        dispatch(loadEnd(data))
    } catch (err) {
        dispatch(loadFailed(err.message))
    }
}
</code></pre><p>Note how we use the <code>ssr</code> helper to wrap our <em>HTTP Request</em>. We don&apos;t really need
it right now because we are not yet running this thing on the server. But keep in
mind that this is the only thign you need to put in place in order to have a
<strong>correct and fluent server side rendering!</strong></p>
<p>Simple, right?</p>
<h3 id="step-3---the-container">Step 3 - the container</h3>
<p>It&apos;s now the right moment to finally step into some React coding and use the data
we store in the Redux&apos; state to provide some decent UI. Paste the following code
into <code>src/features/users/Users.container.js</code>:</p>
<pre><code>import React from &apos;react&apos;
import { connect } from &apos;react-redux&apos;
import { loadUsers } from &apos;./users.service&apos;

const mapState = ({ users }) =&gt; users

const mapDispatch = { loadUsers }

const styles = {
    error: { color: &apos;#f00&apos; },
    list: { textAlign: &apos;left&apos; },
}

class Users extends React.Component {
    constructor (props) {
        super(props)
        const { list, loadUsers } = this.props
        if (!list.length) loadUsers()
    }

    render () {
        if (this.props.isLoading) {
            return &lt;div&gt;loading...&lt;/div&gt;
        }

        if (this.props.errorMsg) {
            return (
                &lt;div style={styles.error}&gt;
                    {this.props.errorMsg}
                &lt;/div&gt;
            )
        }

        return (
            &lt;ul style={styles.list}&gt;
                {this.props.list.map(user =&gt; (
                    &lt;li key={`user-${user.id}`}&gt;{user.name}&lt;/li&gt;
                ))}
            &lt;/ul&gt;
        )
    }
}

export default connect(mapState, mapDispatch)(Users)
</code></pre><p>I did my best to keep this as simple as possible. You can do a way better job
in structuring this thing into some dumb components and, of course, by
applying prop-types, or Flow or TypeScript...</p>
<p>But I would like you to notice that I&apos;ve used <code>constructor()</code> instead of
the most obvious <code>componentDidMount</code> for my network request.. I did that on
 purpose so to make this container server side compatible.</p>
<p>React does not trigget <code>componentDidMount</code> durig ssr and at the moment of the
writing (Nov18) there still some uncertainty about how new versions of React will
handle asynchronous rendering.</p>
<h3 id="step-4---use-the-feature">Step 4 - use the feature</h3>
<p>The last step would be to place the <code>&lt;Users /&gt;</code> container somewhere within our
<code>&lt;App /&gt;</code> so that it can be rendered, the network request triggered using our
service, the reducer updated and the users list produced.</p>
<p>Before we do that let&apos;s have the users feature&apos;s manifest file to export the
ui entry point. Edit <code>src/features/users/index.js</code> as follow:</p>
<pre><code>import loadable from &apos;react-loadable&apos;
import users from &apos;./users.reducer&apos;

// exports the features capabilities:
export const reducers = { users }
export const services = []
export const listeners = []

// exports the UI entry point asynchronously:
export const Users = loadable({
    loader: () =&gt; import(&apos;./Users.container&apos;),
    loading: () =&gt; &apos;loading...&apos;
})
</code></pre><p>With this step done, we can now use the feature in <code>src/App.js</code>:</p>
<pre><code>...

import { Users } from &apos;./features/users&apos;

...

class App extends Component {
    render() {
        return (
                ...
                &lt;Users /&gt;
            &lt;/div&gt;
        )
    }
}
</code></pre><p>The end result should look like this:</p>
<p><img src="../images/create-react-app-ssr__feature-users.png" alt="users feature"></p>
<h2 id="a-word-on-async-features">A word on async features</h2>
<p>I&apos;m sure you noticed that we export out <code>Users</code> containers with
<a href="https://github.com/jamiebuilds/react-loadable" target="_blank">react-loadable</a>.</p>
<p>We could have done a much easier export like:</p>
<pre><code>export { default as Users } from &apos;./Users.container&apos;
</code></pre><p>So why <code>react-loadable</code>?</p>
<p>Well, that is to optimize the bundle size of our app of course! Instead of
producing a single big production bundle file, Webpack is going to generate
a smaller bundle for the main app, and another for the users feature.</p>
<p>Weeeelll... more or less! The truth is that the reducer is going to be part
of the main bundle as well. I played a lot with dynamically loaded reducers
and I must say I find that practice a bit confusing.</p>
<p>It will make you spare some bites in the main bundles, at the cost of increasing
the state manager complexity.</p>
<p>Reducers should hold a very simple responsibility: migrating the state to a new
version. This code is quite simple and does not require error handling because
it is not supposed to fail (if it does it&apos;s a bug, not an error to handle!).</p>
<p><em>IMHO</em> Services hold the complex part of your business logic. Services deal with
network, user input, storage strategies... Services deal with stuff that can
(and will) fail. They do need to perform error handling... extensively!</p>
<p>And then containers/components may bring alogn a big portion of code. React and
CSS, icons and background images... It could sum up to a big chunk of code.</p>
<p>With all that in mind, I believe is a nice compromise to load you reducers
synchronously and your UI/Services asynchronously.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="features.html" class="navigation navigation-prev " aria-label="Previous page: Think in Features">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="features-splash.html" class="navigation navigation-next " aria-label="Next page: splash-screen feature">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"users feature","level":"2.2.3.1","depth":3,"next":{"title":"splash-screen feature","level":"2.2.3.2","depth":3,"path":"howto/features-splash.md","ref":"./howto/features-splash.md","articles":[]},"previous":{"title":"Think in Features","level":"2.2.3","depth":2,"path":"howto/features.md","ref":"./howto/features.md","articles":[{"title":"users feature","level":"2.2.3.1","depth":3,"path":"howto/features-users.md","ref":"./howto/features-users.md","articles":[]},{"title":"splash-screen feature","level":"2.2.3.2","depth":3,"path":"howto/features-splash.md","ref":"./howto/features-splash.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["code","collapsible-menu"],"pluginsConfig":{"code":{"copyButtons":true},"collapsible-menu":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"howto/features-users.md","mtime":"2018-12-22T11:40:40.203Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-05-14T13:33:48.176Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

