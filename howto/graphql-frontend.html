
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>frontend Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-add-js-css/c0a19cc241965e19c45060304d40c6e5-forrestjs.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-insert-logo/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="multilanguage.html" />
    
    
    <link rel="prev" href="graphql-backend.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    ForrestJS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <a target="_blank" href="https://github.com/forrestjs/forrestjs">
            
                    
                    Give us a star on GitHub!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <a target="_blank" href="https://www.npmjs.com/package/forrest">
            
                    
                    Install from NPM
            
                </a>
            

            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../tutorials.html">
            
                <a href="../tutorials.html">
            
                    
                    Read the Tutorials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../packages.html">
            
                <a href="../packages.html">
            
                    
                    Navigate the Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" >
            
                <a target="_blank" href="https://forrestjs.github.io/styleguide">
            
                    
                    Navigate the Styleguide
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Step By Step Tutorial</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <a target="_blank" href="https://marcopeg.com/2019/create-react-app-universal-pwa">
            
                    
                    Create React App > Universal
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="cra-redux.html">
            
                <a href="cra-redux.html">
            
                    
                    Create React App > Redux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="cra-features.html">
            
                <a href="cra-features.html">
            
                    
                    Create React App > Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <a target="_blank" href="https://marcopeg.com/2019/modular-node-apps-with-hooks">
            
                    
                    Hooks, truly modular NodeJS Apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" >
            
                <a target="_blank" href="https://marcopeg.com/2019/graphql-made-easy">
            
                    
                    GraphQL made easy with Hooks
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Articles</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../articles/reducers.html">
            
                <a href="../articles/reducers.html">
            
                    
                    Reducers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../articles/services.html">
            
                <a href="../articles/services.html">
            
                    
                    Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../articles/styled-components.html">
            
                <a href="../articles/styled-components.html">
            
                    
                    SSR with Styled Components
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other Stuff</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../DEVELOPMENT.md">
            
                <span>
            
                    
                    Development
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">DO NOT READ THIS STUFF</li>
        
        
    
        <li class="chapter " data-level="6.1" >
            
                <span>
            
                    
                    Outdated Docs (need review)
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1" data-path="../api/">
            
                <a href="../api/">
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.1.1" data-path="../api/create-ssr-state.html">
            
                <a href="../api/create-ssr-state.html">
            
                    
                    createSSRState
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.1.2" data-path="../api/create-ssr-context.html">
            
                <a href="../api/create-ssr-context.html">
            
                    
                    createSSRContext
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.1.3" data-path="../api/create-ssr-render.html">
            
                <a href="../api/create-ssr-render.html">
            
                    
                    createSSRRender
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.1.4" data-path="../api/create-ssr-router.html">
            
                <a href="../api/create-ssr-router.html">
            
                    
                    createSSRRouter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.1.5" data-path="../api/memcached.html">
            
                <a href="../api/memcached.html">
            
                    
                    Memcached
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.2" >
            
                <span>
            
                    
                    Step By Step Tutorial
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.2.1" data-path="setup.md">
            
                <span>
            
                    
                    Prerequisites & Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.2" data-path="app.html">
            
                <a href="app.html">
            
                    
                    Universal App
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.2.2.1" data-path="app-redux.html">
            
                <a href="app-redux.html">
            
                    
                    React Redux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.2.2" data-path="app-reducers.html">
            
                <a href="app-reducers.html">
            
                    
                    Reducers & Initial State
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.2.3" data-path="features.html">
            
                <a href="features.html">
            
                    
                    Think in Features
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.2.2.3.1" data-path="features-users.html">
            
                <a href="features-users.html">
            
                    
                    users feature
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.2.3.2" data-path="features-splash.html">
            
                <a href="features-splash.html">
            
                    
                    splash-screen feature
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.2.3" data-path="ssr.html">
            
                <a href="ssr.html">
            
                    
                    Server Side Rendering
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.2.3.1" data-path="ssr-folders.html">
            
                <a href="ssr-folders.html">
            
                    
                    Folders structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.3.2" data-path="ssr-babel.html">
            
                <a href="ssr-babel.html">
            
                    
                    Babel setup (transpiler)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.3.3" data-path="ssr-npm-dependencies.html">
            
                <a href="ssr-npm-dependencies.html">
            
                    
                    NPM dependencies
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.3.4" data-path="ssr-npm-scripts.html">
            
                <a href="ssr-npm-scripts.html">
            
                    
                    NPM scripts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.3.5" data-path="ssr-frontend.html">
            
                <a href="ssr-frontend.html">
            
                    
                    the frontend script
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.3.6" data-path="ssr-backend.html">
            
                <a href="ssr-backend.html">
            
                    
                    the backend script
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.3.7" data-path="ssr-kickoff.html">
            
                <a href="ssr-kickoff.html">
            
                    
                    the kickoff scripts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.3.8" data-path="ssr-code-splitting.html">
            
                <a href="ssr-code-splitting.html">
            
                    
                    code splitting
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.2.4" data-path="docker.html">
            
                <a href="docker.html">
            
                    
                    Deploy with Docker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.5" data-path="router.html">
            
                <a href="router.html">
            
                    
                    Add React Router
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.2.5.1" data-path="router-setup.html">
            
                <a href="router-setup.html">
            
                    
                    basic setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.5.2" data-path="router-routes.html">
            
                <a href="router-routes.html">
            
                    
                    add some routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.5.3" data-path="router-load.html">
            
                <a href="router-load.html">
            
                    
                    load stuff
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.2.6" data-path="seo.html">
            
                <a href="seo.html">
            
                    
                    SEO Optimization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.7" data-path="eslint.html">
            
                <a href="eslint.html">
            
                    
                    Customize ESLint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.8" data-path="graphql.html">
            
                <a href="graphql.html">
            
                    
                    Add GraphQL
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1.2.8.1" data-path="graphql-setup.html">
            
                <a href="graphql-setup.html">
            
                    
                    setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.1.2.8.2" data-path="graphql-backend.html">
            
                <a href="graphql-backend.html">
            
                    
                    backend
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="6.1.2.8.3" data-path="graphql-frontend.html">
            
                <a href="graphql-frontend.html">
            
                    
                    frontend
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="6.1.2.9" data-path="multilanguage.html">
            
                <a href="multilanguage.html">
            
                    
                    Add Multilanguage Support
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >frontend</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="graphql---frontend">GraphQL - Frontend</h1>
<p>Now that we have a fully working GraphQL API with some useful endpoints, the only
step left is to adjust our app so to make use of it.</p>
<p>Sit down and relax as this is going to be quick and easy.</p>
<h2 id="initial-state-autodrive">Initial State Autodrive:</h2>
<p>Do you remember the <a href="app-reducers.html">reducers &amp; initial state tutorial</a> where we
set some values for <code>ssr</code>? Here is the code we wrote:</p>
<pre><code>const initialState = window.__REDUX_INITIAL_STATE__ || {
    app: { name: &apos;My Custom App Name&apos; },
    ssr: {
        rootUrl: &apos;http://localhost:8080/&apos;,
        apiUrl: &apos;http://localhost:8080/api/&apos;,
    },
}
</code></pre><p>This initial state allows you to provide custom values for your root and and api urls.
But now we simply want to talk back to our server... well, just comment out (or remove)
the <code>ssr</code> part.</p>
<p>The <code>@marcopeg/react-ssr</code> middleware will fill this up automatically.</p>
<p><strong>NOTE:</strong> you can still have full control over those values, but with SSR you need to move
this configuration into the server, as the initial state is generated there.</p>
<h2 id="webpack-devserver-proxy">Webpack DevServer Proxy</h2>
<p><strong>-- This step applies only for development purposes --</strong></p>
<p>When I work on a client/server app I use to run the <code>npm run start:dev:api</code> in Terminal1,
and <code>npm start</code> in Terminal2. This way Nodemon and Webpack can perform best to live 
reload when I change some code.</p>
<p>The problem is that when my app try to load something from <code>/api</code> I need to forward this
request to my API server. Lukily Webpack DevServer offers a 1 line solution to this problem: <a href="https://webpack.js.org/configuration/dev-server/#devserver-proxy" target="_blank">the proxy</a></p>
<p>If you are running a <code>create-react-app</code> boilerplace just add the proxy setup 
to your <code>package.json</code>:</p>
<pre><code>&quot;proxy&quot;: &quot;http://localhost:8080&quot;
</code></pre><h2 id="graphql-library">GraphQL Library</h2>
<p>Create <code>src/http.lib.js</code>:</p>
<pre><code>// Uses the Fetch api to hit a REST endpoint
// https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
export const postJSON = async (url, data = {}, config = {}) =&gt; {
    const options = {
        method: &apos;POST&apos;,
        headers: { &apos;content-type&apos;: &apos;application/json&apos; },
        body: JSON.stringify(data),
    }

    const res = await fetch(url, options)
    return await res.json()
}

export const runQuery = (query = null, variables = {}) =&gt;
    async (dispatch, getState) =&gt; {
        const { ssr } = getState()
        const endpoint = ssr.getApiUrl(&apos;&apos;)
        return await ssr.await(postJSON(endpoint, {
            query,
            variables,
        }))
    }
</code></pre><h2 id="simplify-the-users-service">Simplify the Users Service</h2>
<p>Edit <code>src/features/users/users.service.js</code> and import the GraphQL library:</p>
<pre><code>import { runQuery } from &apos;../../http.lib&apos;
</code></pre><p>now edit the <code>loadUsers()</code>:</p>
<pre><code>export const loadUsers = () =&gt; async (dispatch) =&gt; {
    try {
        dispatch(loadStart())
        const query = await dispatch(runQuery(`
            query getUsersList {
                users { id name }
            }
        `))
        dispatch(loadEnd(query.data.users))
    } catch (err) {
        dispatch(loadFailed(err.message))
    }
}
</code></pre><p>end edit the <code>loadUser()</code>:</p>
<pre><code>export const loadUser = userId =&gt; async (dispatch) =&gt; {
    try {
        dispatch(loadStart())
        const query = await dispatch(runQuery(`
            query getUser ($userId: ID!) {
                user (id: $userId) { id name email }
                todos (userId: $userId) { id title completed }
                albums (userId: $userId) { id title }
            }
        `, { userId }))

        dispatch(loadEndUser({
            ...query.data.user,
            ...query.data,
        }))
    } catch (err) {
        dispatch(loadFailed(err.message))
    }
}
</code></pre><p>finally we can now get rid of:</p>
<ul>
<li><code>fetchUser()</code></li>
<li><code>fetchUserTodos()</code></li>
<li><code>fetchUserAlbums()</code></li>
</ul>
<p><strong>NOTE:</strong> we were able to remove 3 functions because now all we need to do is to
pack a well structured GraphQL query that is capable of retrieving all the data we
need for a single user!</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="graphql-backend.html" class="navigation navigation-prev " aria-label="Previous page: backend">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="multilanguage.html" class="navigation navigation-next " aria-label="Next page: Add Multilanguage Support">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"frontend","level":"6.1.2.8.3","depth":4,"next":{"title":"Add Multilanguage Support","level":"6.1.2.9","depth":3,"path":"howto/multilanguage.md","ref":"./howto/multilanguage.md","articles":[]},"previous":{"title":"backend","level":"6.1.2.8.2","depth":4,"path":"howto/graphql-backend.md","ref":"./howto/graphql-backend.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["add-js-css","custom-favicon","insert-logo","code","collapsible-menu"],"pluginsConfig":{"collapsible-menu":{},"search":{},"add-js-css":{"css":["./forrestjs.css"]},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":"/images/forrestjs.ico","custom-favicon":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"insert-logo":{"url":"/images/forrestjs.png","style":"background: none;"}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"howto/graphql-frontend.md","mtime":"2018-12-24T16:04:09.640Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-09-05T14:23:40.232Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-insert-logo/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

